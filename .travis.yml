language: csharp
solution: B9PartSwitch.sln
install:
  - bundle install
  - build_script/install/install_ksp_dlls.sh
  - nuget restore ${TRAVIS_SOLUTION}
script:
  - msbuild /p:Configuration=Release /p:ReferencePath="${KSP_DLL_PATH}" ${TRAVIS_SOLUTION}
  - bin/test
  - build_script/script/make_release.sh
  - build_script/script/avc_version.rb files/B9PartSwitch.version.erb release/GameData/B9PartSwitch/B9PartSwitch.version
  - build_script/script/make_zip.sh
before_deploy:
  - build_script/before_deploy/copy_zip.sh
  - mkdir bintray
  - build_script/before_deploy/populate_bintray.rb files/bintray/publish_build.json.erb bintray/publish_build.json
  - build_script/before_deploy/populate_bintray.rb files/bintray/publish_avc_version.json.erb bintray/publish_avc_version.json
deploy:
  - provider: bintray
    file: bintray/publish_build.json
    user: blowfishpro
    key: ${BINTRAY_API_KEY}
  - provider: releases
    api_key: ${GITHUB_DEPLOY_TOKEN}
    file: zip_release/github/*.zip
    file_glob: true
    name: "${PROJECT_NAME} ${TRAVIS_TAG} for KSP ${KSP_VERSION}"
    on:
      tags: true
  - provider: bintray
    file: bintray/publish_avc_version.json
    user: blowfishpro
    key: ${BINTRAY_API_KEY}
    on:
      tags: true
env:
  global:
    - PROJECT_NAME="B9PartSwitch"
    - PROJECT_DIR="B9PartSwitch"
    - KSP_VERSION="$(cat KSP_VERSION)"
    - KSP_DLL_PATH="${TRAVIS_BUILD_DIR}/KSP_DLLs/${KSP_VERSION}"
notifications:
  email: false
git:
  depth: 200
